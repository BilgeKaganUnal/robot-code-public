<!DOCTYPE hmtl>

<html>
  <head>
    <title>1678 WebDash</title>
  </head>
  <body>
    <center>
      <form id="auto">
      </form>
      <form>
        <input type="text" id="logname">
        <input type="button" value="Set a name for this run" onclick="sendLogName()">
      </form>
      <a href="/data.html">Live data view</a>
      <br/>
      <a href="/display.html">Operator Display</a>
      <br/>
      <p>Don't Panic!</p>
    </center>
  </body>
  <script>
    var webdashmodesock = new WebSocket("ws://" + document.location.host + "/webdashmode");
    webdashmodesock.onmessage = function(data) {
      if (data.data != "Roborio") {
        var element = document.getElementById("auto");
        element.parentNode.removeChild(element);
      }
    }
    // Auto sender
    var autosock = new WebSocket("ws://" + document.location.host + "/auto");
    var logsock = new WebSocket("ws://" + document.location.host + "/logname");
    var autolistsock = new WebSocket("ws://" + document.location.host + "/autolist");
    function getRadioCheckedValue(radio_name) {
    var oRadio = document.forms[0].elements[radio_name];
      for(var i = 0; i < oRadio.length; i++) {
        if(oRadio[i].checked) {
          return oRadio[i].value;
        }
      }
      return '';
    }
    function sendAutoData() {
      autosock.send(getRadioCheckedValue("auto"));
    }
    function sendLogName() {
      logsock.send(document.getElementById("logname").value);
    }
    // Creates html from json interpreted vector of autos to display on webdash
    autolistsock.onmessage = function(data) {
      var element = document.getElementById("auto");
      if (element == undefined) {
        return;
      }
      var autolist = JSON.parse(data.data);
      var auto_length = autolist.length;
      var html_string = "<p>Auto mode:</p>";
      for (var i=0; i < auto_length; i++) {
        html_string += "<input type=\"radio\" name=\"auto\" value=\"" + autolist[i] + "\">" + autolist[i] + "<br>\n"; 
      }
      html_string += "<input type=\"button\" value=\"Update Auto\" onclick=\"sendAutoData()\">"
      element.innerHTML = html_string;
    };
    autolistsock.onopen = function() {
      autolistsock.send("ping");
    }
  </script>
</html>
